<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Browser Compatibility Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 10px; }
        #log { background: #f5f5f5; padding: 10px; height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Browser Compatibility Test</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="log"></div>
    </div>

    <!-- Mock DOM elements that the renderer expects -->
    <div style="display: none;">
        <button id="add-files-btn">Add Files</button>
        <button id="add-directory-btn">Add Directory</button>
        <button id="refresh-btn">Refresh</button>
        <button id="clear-btn">Clear</button>
        <button id="export-btn">Export</button>
        <button id="retry-btn">Retry</button>
        
        <div id="file-list"></div>
        <span id="entity-count">0</span>
        <span id="relationship-count">0</span>
        <span id="file-count">0</span>
        
        <select id="view-mode">
            <option value="formatted">Formatted</option>
        </select>
        <pre id="json-output"></pre>
        
        <div id="loading-state"></div>
        <div id="empty-state"></div>
        <div id="analysis-content"></div>
        <div id="error-state"></div>
        <p id="error-message"></p>
        
        <span id="status-text"></span>
        <span id="last-analysis"></span>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Mock electronAPI
        window.electronAPI = {
            selectFiles: async () => {
                log('üìÅ selectFiles() called', 'info');
                return ['/test/User.java', '/test/Order.java'];
            },
            
            selectDirectory: async () => {
                log('üìÇ selectDirectory() called', 'info');
                return '/test/entities';
            },
            
            analyzeEntities: async (filePaths) => {
                log(`üîç analyzeEntities() called with ${filePaths.length} files`, 'info');
                return {
                    entities: [
                        { name: 'User', tableName: 'users' },
                        { name: 'Order', tableName: 'orders' }
                    ],
                    relationships: [],
                    metadata: { totalEntities: 2, totalRelationships: 0 }
                };
            },
            
            exportAnalysis: async (data) => {
                log('üíæ exportAnalysis() called', 'info');
                return true;
            },
            
            onMenuAddFiles: (callback) => {
                log('‚úì onMenuAddFiles() registered', 'success');
                window._menuAddFilesCallback = callback;
            },
            
            onMenuAddDirectory: (callback) => {
                log('‚úì onMenuAddDirectory() registered', 'success');
                window._menuAddDirectoryCallback = callback;
            },
            
            onMenuExportAnalysis: (callback) => {
                log('‚úì onMenuExportAnalysis() registered', 'success');
                window._menuExportAnalysisCallback = callback;
            },
            
            onMenuRefreshAnalysis: (callback) => {
                log('‚úì onMenuRefreshAnalysis() registered', 'success');
                window._menuRefreshAnalysisCallback = callback;
            },
            
            onMenuClearFiles: (callback) => {
                log('‚úì onMenuClearFiles() registered', 'success');
                window._menuClearFilesCallback = callback;
            }
        };

        log('üß™ Starting browser compatibility test...', 'info');
        log('üìã Mock electronAPI set up', 'success');
    </script>

    <!-- Load the fixed renderer -->
    <script src="assets/renderer-fixed.js"></script>

    <script>
        // Test the renderer after it loads
        setTimeout(() => {
            log('üß™ Testing renderer functionality...', 'info');
            
            if (typeof window.renderer !== 'undefined') {
                log('‚úÖ Renderer loaded successfully', 'success');
                
                // Test button clicks
                try {
                    const addFilesBtn = document.getElementById('add-files-btn');
                    if (addFilesBtn && addFilesBtn.click) {
                        log('üñ±Ô∏è Testing Add Files button...', 'info');
                        addFilesBtn.click();
                        log('‚úÖ Add Files button works', 'success');
                    }
                } catch (error) {
                    log(`‚ùå Add Files button error: ${error.message}`, 'error');
                }
                
                // Test menu callbacks
                try {
                    if (window._menuAddFilesCallback) {
                        log('üñ±Ô∏è Testing menu callback...', 'info');
                        window._menuAddFilesCallback();
                        log('‚úÖ Menu callback works', 'success');
                    }
                } catch (error) {
                    log(`‚ùå Menu callback error: ${error.message}`, 'error');
                }
                
            } else {
                log('‚ùå Renderer failed to load', 'error');
            }
            
            log('üéâ Browser compatibility test completed!', 'success');
        }, 1000);
    </script>
</body>
</html>